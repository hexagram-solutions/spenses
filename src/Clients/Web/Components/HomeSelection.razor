@using Spenses.Client.Web.Features.Homes
@using Spenses.Application.Models.Homes
@inherits BlazorState.BlazorStateComponent

@inject NavigationManager NavigationManager;

<BarItem>
  <BarDropdown>
    <BarDropdownToggle>@(CurrentHome?.Name ?? "Loading")</BarDropdownToggle>
    <BarDropdownMenu>
      @if (HomeState.HomesRequesting && CurrentHome is null)
      {
        <BarDropdownItem>
          Loading...
        </BarDropdownItem>
      }
      else
      {
        @foreach (var home in HomeState.Homes!)
        {
          <BarDropdownItem>
            <Blazorise.Link To="@($"homes/{home.Id}/dashboard")">@home.Name</Blazorise.Link>
          </BarDropdownItem>
        }
      }
    </BarDropdownMenu>
  </BarDropdown>
</BarItem>

@code
{
  HomeState HomeState => GetState<HomeState>();

  private Home? CurrentHome => HomeState.CurrentHome;

  protected override async Task OnInitializedAsync()
  {
    await Mediator.Send(new HomeState.HomesRequested());
  }

  private async Task SelectHome(Guid homeId)
  {
    await Mediator.Send(new HomeState.HomeSelected(homeId));
  }
}
